{% extends 'baseuser.html' %}
{% load static %}
{% block title %}主菜選択{% endblock %}

{% block content %}
    <div class="container">
        <!-- 主菜選択フォーム -->
        <main>
            <!-- staticをロード -->
            {% load static %}
            <link rel="stylesheet" href="{% static 'css/health/health_selection.css' %}">
            <div class="meal-selection">
                <h2>主菜選択</h2>
                <form id="dish-form">
                    <label for="dish">主菜を選んでください:</label>
                    <select id="dish" name="dish" required onchange="updateIngredients()">
                        <option value="">選択してください</option>
                        <option value="唐揚げ">唐揚げ</option>
                        <option value="焼き魚">焼き魚</option>
                        <option value="ステーキ">ステーキ</option>
                        <option value="カレー">カレー</option>
                        <option value="パスタ">パスタ</option>
                    </select>
                </form>
                <div id="ingredients" class="ingredients-list"><strong>材料:</strong> 主菜を選んでください。</div>
            </div>

            <div class="meal-time-selection">
                <h3>時間帯</h3>
                <p>登録した主菜は以下の時間帯で表示されます。</p>

                <button id="morning-btn" onclick="setMealTime('朝')">朝</button>
                <button id="afternoon-btn" onclick="setMealTime('昼')">昼</button>
                <button id="evening-btn" onclick="setMealTime('晩')">晩</button>

                <div id="meal-status" class="meal-status">
                    <p id="dish-status">主菜は未定です。</p>
                </div>
            </div>

            <div class="action-buttons">
                <button onclick="goBack()">戻る</button>
                <button class="register" onclick="registerMeal()">登録</button>
            </div>
        </main>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        const ingredientsData = {
            "唐揚げ": ["鶏肉", "しょうゆ", "にんにく", "しょうが", "片栗粉"],
            "焼き魚": ["魚（さば、さんま等）", "塩", "レモン"],
            "ステーキ": ["牛肉", "塩", "コショウ", "オリーブオイル"],
            "カレー": ["カレールー", "にんじん", "じゃがいも", "玉ねぎ", "鶏肉"],
            "パスタ": ["パスタ", "トマトソース", "にんにく", "オリーブオイル", "バジル"]
        };

        let selectedDish = "";
        let selectedMealTime = "";

        function updateIngredients() {
            const dish = document.getElementById("dish").value;
            const ingredientsList = document.getElementById("ingredients");
            selectedDish = dish;
            const ingredients = ingredientsData[dish] || [];
            ingredientsList.innerHTML = ingredients.length
                ? `<strong>材料:</strong> ${ingredients.join(", ")}`
                : "<strong>材料:</strong> 主菜を選んでください。";
        }

        function setMealTime(mealTime) {
            selectedMealTime = mealTime;
            document.getElementById("dish-status").innerText = `主菜は${mealTime}に設定されました。`;
            highlightMealTime(mealTime);
        }

        function highlightMealTime(mealTime) {
            const buttons = document.querySelectorAll(".meal-time-selection button");
            buttons.forEach(btn => {
                if (btn.innerText === mealTime) {
                    btn.classList.add("selected");
                } else {
                    btn.classList.remove("selected");
                }
            });
        }

        function registerMeal() {
            if (!selectedDish || !selectedMealTime) {
                alert("主菜と時間帯を選択してください。");
            } else {
                alert(`主菜「${selectedDish}」を${selectedMealTime}に登録しました。`);
            }
        }

        function goBack() {
            history.back();
        }
    </script>
{% endblock %}
